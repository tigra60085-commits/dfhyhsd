"""Drug database organized by pharmacological class."""

DRUG_CLASSES = [
    "SSRI",
    "SNRI",
    "TCA",
    "MAOI",
    "Атипичные антидепрессанты",
    "Типичные антипсихотики",
    "Атипичные антипсихотики",
    "Стабилизаторы настроения",
    "Бензодиазепины",
    "Z-препараты",
    "Стимуляторы",
]

DRUGS = [
    # SSRIs
    {
        "name": "Флуоксетин",
        "class": "SSRI",
        "mechanism": "Избирательно блокирует обратный захват серотонина (5-HT) в синаптической щели, повышая серотонинергическую передачу.",
        "indications": ["Большое депрессивное расстройство", "ОКР", "Булимия", "Паническое расстройство", "ПТСР"],
        "side_effects": ["Тошнота", "Бессонница", "Сексуальная дисфункция", "Тревога в начале терапии", "Головная боль"],
        "interactions": ["MAOIs (серотониновый синдром)", "Трамадол", "Трициклические антидепрессанты", "Варфарин"],
        "dosage": "20–80 мг/сут, длинный T½ (~1–4 дня), активный метаболит норфлуоксетин T½ ~7–15 дней",
    },
    {
        "name": "Сертралин",
        "class": "SSRI",
        "mechanism": "Мощное избирательное ингибирование обратного захвата серотонина с минимальным влиянием на другие нейромедиаторы.",
        "indications": ["Депрессия", "ОКР", "Паническое расстройство", "ПТСР", "Социальная фобия", "ПМС"],
        "side_effects": ["Диарея", "Тошнота", "Сухость во рту", "Сексуальная дисфункция", "Бессонница"],
        "interactions": ["MAOIs", "Пимозид (строго противопоказан)", "Варфарин"],
        "dosage": "50–200 мг/сут, T½ ~26 ч",
    },
    {
        "name": "Эсциталопрам",
        "class": "SSRI",
        "mechanism": "Наиболее селективный SSRI — S-энантиомер циталопрама; блокирует аллостерический сайт переносчика серотонина.",
        "indications": ["Депрессия", "ГТР", "Паническое расстройство", "Социальное тревожное расстройство", "ОКР"],
        "side_effects": ["Тошнота", "Бессонница", "Сексуальная дисфункция", "Удлинение QTc (доза-зависимое)"],
        "interactions": ["MAOIs", "Удлиняющие QT препараты", "Трамадол"],
        "dosage": "10–20 мг/сут, T½ ~27–32 ч",
    },
    {
        "name": "Пароксетин",
        "class": "SSRI",
        "mechanism": "Ингибирует обратный захват 5-HT + умеренная m-холинолитическая активность; ингибитор CYP2D6.",
        "indications": ["Депрессия", "ОКР", "Паническое расстройство", "Социальная фобия", "ПТСР", "ГТР"],
        "side_effects": ["Прибавка в весе", "Седация", "Сухость во рту", "Запор", "Выраженный синдром отмены"],
        "interactions": ["MAOIs", "Тамоксифен (снижает эффект через CYP2D6)", "ТЦА"],
        "dosage": "20–60 мг/сут, T½ ~21 ч (выраженные нелинейные фармакокинетика)",
    },
    # SNRIs
    {
        "name": "Венлафаксин",
        "class": "SNRI",
        "mechanism": "При низких дозах — преимущественно ингибирует захват 5-HT; при высоких добавляется ингибирование NE; слабое DA при очень высоких дозах.",
        "indications": ["Депрессия", "ГТР", "Паническое расстройство", "Социальная фобия", "ПТСР"],
        "side_effects": ["Тошнота", "Повышение АД (доза-зависимое)", "Потливость", "Сексуальная дисфункция", "Синдром отмены"],
        "interactions": ["MAOIs", "Трамадол", "Суматриптан"],
        "dosage": "75–375 мг/сут (ER форма), T½ ~5 ч (активный метаболит O-десметилвенлафаксин T½ ~11 ч)",
    },
    {
        "name": "Дулоксетин",
        "class": "SNRI",
        "mechanism": "Сбалансированное ингибирование обратного захвата 5-HT и NE (примерно 1:1 по аффинности).",
        "indications": ["Депрессия", "ГТР", "Нейропатическая боль при диабете", "Фибромиалгия", "Стрессовое недержание мочи"],
        "side_effects": ["Тошнота", "Сухость во рту", "Запор", "Бессонница", "Головокружение"],
        "interactions": ["MAOIs", "Ингибиторы CYP1A2 (флувоксамин)", "Антикоагулянты"],
        "dosage": "60–120 мг/сут, T½ ~12 ч",
    },
    # TCAs
    {
        "name": "Амитриптилин",
        "class": "TCA",
        "mechanism": "Ингибирует обратный захват 5-HT и NE; мощный антагонист H1, m-холинорецепторов и α1-адренорецепторов.",
        "indications": ["Депрессия", "Нейропатическая боль", "Мигрень (профилактика)", "Фибромиалгия", "Энурез у детей"],
        "side_effects": ["Седация", "Сухость во рту", "Запор", "Задержка мочи", "Ортостатическая гипотензия", "Кардиотоксичность при передозировке"],
        "interactions": ["MAOIs", "Антиаритмики", "Антихолинергические препараты", "Алкоголь"],
        "dosage": "75–300 мг/сут, T½ ~10–28 ч",
    },
    {
        "name": "Кломипрамин",
        "class": "TCA",
        "mechanism": "Наиболее мощный ингибитор захвата 5-HT среди ТЦА + значимое NE-ингибирование.",
        "indications": ["ОКР (золотой стандарт среди ТЦА)", "Депрессия", "Паническое расстройство", "Катаплексия"],
        "side_effects": ["Выраженная седация", "Сексуальная дисфункция", "Холинолитические эффекты", "Снижение судорожного порога"],
        "interactions": ["MAOIs", "Серотонинергические препараты", "CYP2D6 ингибиторы"],
        "dosage": "75–250 мг/сут, T½ ~32 ч",
    },
    # MAOIs
    {
        "name": "Фенелзин",
        "class": "MAOI",
        "mechanism": "Необратимый неселективный ингибитор MAO-A и MAO-B → повышение NE, 5-HT, DA и снижение метаболизма тирамина.",
        "indications": ["Атипичная депрессия", "Социальная фобия", "ПТСР", "Паническое расстройство (рефрактерные случаи)"],
        "side_effects": ["Гипертонический криз при употреблении тирамина", "Ортостатическая гипотензия", "Бессонница", "Прибавка в весе", "Сексуальная дисфункция"],
        "interactions": ["Тираминсодержащие продукты", "Симпатомиметики", "Все серотонинергические препараты", "Опиоиды (особенно меперидин)"],
        "dosage": "45–90 мг/сут в 3 приёма; требуется отмена за 2 недели до других антидепрессантов",
    },
    {
        "name": "Моклобемид",
        "class": "MAOI",
        "mechanism": "Обратимый селективный ингибитор MAO-A (RIMA) → менее выраженное взаимодействие с тирамином.",
        "indications": ["Депрессия", "Социальная фобия"],
        "side_effects": ["Тошнота", "Бессонница", "Головокружение", "Меньше холинолитических эффектов"],
        "interactions": ["Серотонинергические препараты", "Симпатомиметики (умеренное ограничение по тирамину)"],
        "dosage": "300–600 мг/сут в 2–3 приёма, T½ ~1–2 ч",
    },
    # Atypical antidepressants
    {
        "name": "Бупропион",
        "class": "Атипичные антидепрессанты",
        "mechanism": "Ингибирует обратный захват NE и DA (NDRI); не влияет на 5-HT.",
        "indications": ["Депрессия", "Отказ от курения", "СДВГ (off-label)", "Сезонное аффективное расстройство"],
        "side_effects": ["Бессонница", "Снижение судорожного порога (доза-зависимое)", "Сухость во рту", "Тахикардия", "НЕ вызывает сексуальную дисфункцию"],
        "interactions": ["MAOIs", "Тамоксифен (ингибитор CYP2D6)", "Препараты, снижающие судорожный порог"],
        "dosage": "150–450 мг/сут (SR/XL форма), T½ ~21 ч",
    },
    {
        "name": "Миртазапин",
        "class": "Атипичные антидепрессанты",
        "mechanism": "Антагонист α2-адренорецепторов (пресинаптических) → повышение выброса NE и 5-HT; блокада 5-HT2 и 5-HT3; мощная блокада H1.",
        "indications": ["Депрессия (особенно с бессонницей и сниженным аппетитом)", "ГТР"],
        "side_effects": ["Выраженная седация (особенно при малых дозах)", "Прибавка в весе", "Повышение аппетита", "Агранулоцитоз (редко)"],
        "interactions": ["MAOIs", "Алкоголь (усиление седации)", "Бензодиазепины"],
        "dosage": "15–45 мг/сут (1 раз на ночь), T½ ~20–40 ч",
    },
    {
        "name": "Тразодон",
        "class": "Атипичные антидепрессанты",
        "mechanism": "Антагонист 5-HT2A/2C + слабый ингибитор захвата 5-HT; H1-блокада обусловливает седацию.",
        "indications": ["Депрессия", "Бессонница (sub-терапевтические дозы)", "Тревога"],
        "side_effects": ["Седация", "Ортостатическая гипотензия", "Приапизм (редко, но требует немедленного внимания)", "Головокружение"],
        "interactions": ["MAOIs", "CYP3A4 ингибиторы", "Антигипертензивные препараты"],
        "dosage": "150–600 мг/сут при депрессии; 25–100 мг на ночь при бессоннице",
    },
    # Typical antipsychotics
    {
        "name": "Галоперидол",
        "class": "Типичные антипсихотики",
        "mechanism": "Мощный антагонист D2-рецепторов в мезолимбическом пути; высокое отношение D2/мускариновая блокада.",
        "indications": ["Шизофрения", "Острые психозы", "Делирий", "Синдром Туретта", "Тяжёлые поведенческие нарушения"],
        "side_effects": ["Экстрапирамидные расстройства (акатизия, дистония, паркинсонизм)", "Поздняя дискинезия", "Нейролептический злокачественный синдром", "Гиперпролактинемия", "Удлинение QTc"],
        "interactions": ["Антихолинергические препараты", "ЦНС-депрессанты", "Препараты, удлиняющие QT", "Антипаркинсонические средства"],
        "dosage": "2–20 мг/сут (пероральный); депо-форма 50–200 мг в/м каждые 4 недели",
    },
    {
        "name": "Хлорпромазин",
        "class": "Типичные антипсихотики",
        "mechanism": "Антагонист D1/D2 + блокада α1, H1, mAChR → широкий спектр нейромедиаторных эффектов.",
        "indications": ["Шизофрения", "Маниакальные эпизоды", "Тяжёлая тошнота/рвота", "Икота"],
        "side_effects": ["Выраженная седация", "Антихолинергические эффекты", "Фотосенсибилизация", "Желтуха", "ЭПС"],
        "interactions": ["Антигипертензивные препараты", "Антихолинергические средства", "Леводопа"],
        "dosage": "100–1000 мг/сут в разделённых дозах",
    },
    # Atypical antipsychotics
    {
        "name": "Оланзапин",
        "class": "Атипичные антипсихотики",
        "mechanism": "Антагонист D2, 5-HT2A, H1, α1, mAChR. Более высокое отношение 5-HT2A/D2 блокады по сравнению с типичными.",
        "indications": ["Шизофрения", "Биполярная мания (острая)", "Биполярное расстройство (поддерживающая терапия)", "Анорексия (off-label)"],
        "side_effects": ["Выраженная прибавка в весе", "Метаболический синдром", "Гипергликемия/диабет 2 типа", "Седация", "Минимальные ЭПС"],
        "interactions": ["Флувоксамин (повышает уровень)", "Карбамазепин (снижает уровень)", "Антидиабетические препараты"],
        "dosage": "5–20 мг/сут, T½ ~30 ч",
    },
    {
        "name": "Клозапин",
        "class": "Атипичные антипсихотики",
        "mechanism": "Широкий полирецепторный антагонизм (D1-4, 5-HT, H1, α, mAChR); уникальная эффективность при рефрактерной шизофрении.",
        "indications": ["Рефрактерная шизофрения", "Суицидальность при шизофрении/шизоаффективном расстройстве"],
        "side_effects": ["Агранулоцитоз (требует мониторинга ОАК)", "Миокардит", "Судороги (доза-зависимые)", "Гиперсаливация", "Выраженная прибавка в весе", "Ортостатическая гипотензия"],
        "interactions": ["CYP1A2 ингибиторы/индукторы (курение!)", "Бензодиазепины (риск остановки дыхания)", "Препараты, угнетающие кроветворение"],
        "dosage": "150–600 мг/сут, T½ ~12 ч; титрование обязательно",
    },
    {
        "name": "Рисперидон",
        "class": "Атипичные антипсихотики",
        "mechanism": "Антагонист D2 и 5-HT2A (высокое сродство); также блокирует α1 и H1.",
        "indications": ["Шизофрения", "Биполярная мания", "Раздражительность при аутизме"],
        "side_effects": ["Гиперпролактинемия (выраженная)", "ЭПС при высоких дозах", "Прибавка в весе", "Ортостатическая гипотензия"],
        "interactions": ["CYP2D6 ингибиторы (пароксетин)", "Антигипертензивные препараты", "Карбамазепин"],
        "dosage": "2–16 мг/сут, T½ ~20 ч (+ активный метаболит 9-гидроксирисперидон)",
    },
    {
        "name": "Арипипразол",
        "class": "Атипичные антипсихотики",
        "mechanism": "Частичный агонист D2 и 5-HT1A; антагонист 5-HT2A — «стабилизатор допамина».",
        "indications": ["Шизофрения", "Биполярное расстройство (мания и поддерживающая терапия)", "Дополнение к антидепрессантам при депрессии"],
        "side_effects": ["Акатизия (довольно частая)", "Тошнота", "Бессонница", "Минимальная прибавка в весе", "Минимальная гиперпролактинемия"],
        "interactions": ["CYP2D6/3A4 ингибиторы", "Карбамазепин (индукция снижает уровень)"],
        "dosage": "10–30 мг/сут, T½ ~75 ч (длинный!)",
    },
    {
        "name": "Кветиапин",
        "class": "Атипичные антипсихотики",
        "mechanism": "Антагонист D2, 5-HT2A, H1, α1; слабая D2-блокада при низких дозах.",
        "indications": ["Шизофрения", "Биполярная мания/депрессия", "Дополнение при депрессии (низкие дозы)", "Бессонница (off-label, низкие дозы)"],
        "side_effects": ["Выраженная седация", "Прибавка в весе", "Метаболический синдром", "Катаракта (требует офтальмологического контроля)"],
        "interactions": ["CYP3A4 ингибиторы/индукторы", "Антигипертензивные препараты", "Тиоридазин"],
        "dosage": "150–750 мг/сут при психозе; 50–300 мг при депрессии/биполярном расстройстве",
    },
    # Mood stabilizers
    {
        "name": "Лития карбонат",
        "class": "Стабилизаторы настроения",
        "mechanism": "Точный механизм неизвестен; ингибирует инозитолмонофосфатазу (истощение инозитола), модулирует GSK-3β, нейротрофические факторы.",
        "indications": ["Биполярное расстройство (острая мания и профилактика)", "Рекуррентная депрессия (аугментация)", "Суицидальность"],
        "side_effects": ["Тремор", "Полиурия/полидипсия (нефрогенный несахарный диабет)", "Гипотиреоз", "Угревая сыпь", "Тератогенность (аномалия Эбштейна)"],
        "interactions": ["НПВС (повышают уровень лития)", "Тиазидные диуретики", "АПФ-ингибиторы", "Нейролептики"],
        "dosage": "Терапевтический диапазон: 0.6–1.2 ммоль/л (острая мания до 1.5); мониторинг уровня, ТТГ, функции почек",
    },
    {
        "name": "Вальпроат",
        "class": "Стабилизаторы настроения",
        "mechanism": "Блокирует Na+-каналы (инактивированное состояние); усиливает ГАМК-ергическую передачу; ингибирует гистондеацетилазу.",
        "indications": ["Биполярная мания (острая и профилактика)", "Эпилепсия (разные формы)", "Мигрень (профилактика)"],
        "side_effects": ["Тератогенность (дефекты нервной трубки, нарушения развития!)", "Панкреатит", "Гепатотоксичность", "Тромбоцитопения", "Прибавка в весе", "Выпадение волос"],
        "interactions": ["Ламотриджин (удваивает T½)", "Аспирин", "Карбамазепин", "Фенитоин"],
        "dosage": "750–2500 мг/сут; терапевтический уровень 50–125 мкг/мл",
    },
    {
        "name": "Ламотриджин",
        "class": "Стабилизаторы настроения",
        "mechanism": "Блокирует Na+-каналы в возбуждённом состоянии → уменьшает высвобождение возбуждающих нейромедиаторов (глутамат, аспартат).",
        "indications": ["Биполярное расстройство (профилактика депрессивных фаз)", "Эпилепсия"],
        "side_effects": ["Синдром Стивенса–Джонсона (при быстрой титрации!)", "Сыпь", "Диплопия", "Головокружение", "Бессонница"],
        "interactions": ["Вальпроат (удваивает уровень ламотриджина)", "Карбамазепин (снижает уровень)", "Гормональные контрацептивы (снижают уровень)"],
        "dosage": "100–400 мг/сут; ОБЯЗАТЕЛЬНАЯ медленная титрация (снижает риск сыпи)",
    },
    # Benzodiazepines
    {
        "name": "Диазепам",
        "class": "Бензодиазепины",
        "mechanism": "Аллостерический положительный модулятор ГАМК-А рецепторов → усиление тока Cl⁻ → гиперполяризация.",
        "indications": ["Тревожные расстройства", "Эпилептический статус", "Синдром отмены алкоголя", "Мышечный спазм", "Преоперационная премедикация"],
        "side_effects": ["Седация", "Когнитивные нарушения", "Зависимость/толерантность", "Синдром отмены", "Угнетение дыхания"],
        "interactions": ["Алкоголь", "Опиоиды (риск остановки дыхания)", "ЦНС-депрессанты", "Флумазенил (антидот)"],
        "dosage": "2–10 мг 2–4 раза в сутки при тревоге; T½ ~20–100 ч (длинный, активные метаболиты)",
    },
    {
        "name": "Лоразепам",
        "class": "Бензодиазепины",
        "mechanism": "Аллостерический модулятор ГАМК-А; высокое сродство к рецептору.",
        "indications": ["Тревога", "Острая паника", "Эпилептический статус (в/в)", "Премедикация", "Острые психозы (в/м)"],
        "side_effects": ["Седация", "Антероградная амнезия", "Угнетение дыхания", "Зависимость"],
        "interactions": ["Алкоголь", "Клозапин (риск тяжёлой гипотензии при в/м введении)", "ЦНС-депрессанты"],
        "dosage": "0.5–4 мг/сут; T½ ~10–20 ч (без активных метаболитов — удобен при печёночной патологии)",
    },
    {
        "name": "Клоназепам",
        "class": "Бензодиазепины",
        "mechanism": "Аллостерический модулятор ГАМК-А; выраженная анксиолитическая и противоэпилептическая активность.",
        "indications": ["Паническое расстройство", "Социальная фобия (краткосрочно)", "Эпилепсия", "Акатизия (от антипсихотиков)"],
        "side_effects": ["Седация", "Когнитивные нарушения", "Депрессия", "Зависимость"],
        "interactions": ["ЦНС-депрессанты", "Вальпроат", "Алкоголь"],
        "dosage": "0.5–4 мг/сут в 2–3 приёма; T½ ~18–50 ч",
    },
    # Z-drugs
    {
        "name": "Золпидем",
        "class": "Z-препараты",
        "mechanism": "Селективный агонист ГАМК-А рецепторов, содержащих субъединицу α1 (отвечает за седацию, менее — за тревогу/миорелаксацию).",
        "indications": ["Бессонница (краткосрочная)"],
        "side_effects": ["Парасомнии (лунатизм, вождение во сне)", "Когнитивные нарушения", "Антероградная амнезия", "Зависимость (меньше, чем бензодиазепины)"],
        "interactions": ["Алкоголь", "ЦНС-депрессанты", "CYP3A4 ингибиторы"],
        "dosage": "5–10 мг перед сном; T½ ~2.5 ч (короткий)",
    },
    # Stimulants
    {
        "name": "Метилфенидат",
        "class": "Стимуляторы",
        "mechanism": "Блокирует обратный захват DA и NE (преимущественно DA) в префронтальной коре и стриатуме.",
        "indications": ["СДВГ (у детей и взрослых)", "Нарколепсия"],
        "side_effects": ["Снижение аппетита", "Бессонница", "Тахикардия", "Повышение АД", "Задержка роста у детей при длительном применении"],
        "interactions": ["MAOIs", "Антигипертензивные препараты", "Антикоагулянты"],
        "dosage": "5–60 мг/сут в разделённых дозах (IR) или 18–72 мг/сут (ER/OROS), T½ ~2–3 ч (IR)",
    },
    {
        "name": "Атомоксетин",
        "class": "Стимуляторы",
        "mechanism": "Избирательный ингибитор обратного захвата NE (не является контролируемым веществом в отличие от стимуляторов).",
        "indications": ["СДВГ (взрослые и дети ≥6 лет)", "Тревожные расстройства при СДВГ"],
        "side_effects": ["Тошнота", "Снижение аппетита", "Бессонница", "Гепатотоксичность (редко)", "Суицидальные мысли (чёрная рамка у детей)"],
        "interactions": ["MAOIs (строго противопоказаны)", "CYP2D6 ингибиторы (пароксетин, флуоксетин)"],
        "dosage": "40–100 мг/сут (1–2 раза в сутки), T½ ~5 ч у быстрых метаболизаторов по CYP2D6",
    },
]


def get_drugs_by_class(drug_class: str) -> list:
    return [d for d in DRUGS if d["class"] == drug_class]


def get_drug_by_name(name: str) -> dict | None:
    for d in DRUGS:
        if d["name"].lower() == name.lower():
            return d
    return None


def search_drugs(query: str) -> list:
    q = query.lower()
    results = []
    for d in DRUGS:
        if (q in d["name"].lower()
                or q in d["class"].lower()
                or q in d["mechanism"].lower()
                or any(q in ind.lower() for ind in d["indications"])):
            results.append(d)
    return results
