"""Drug database organized by pharmacological class."""

DRUG_CLASSES = [
    "SSRI",
    "SNRI",
    "TCA",
    "MAOI",
    "Атипичные антидепрессанты",
    "Типичные антипсихотики",
    "Атипичные антипсихотики",
    "Стабилизаторы настроения",
    "Бензодиазепины",
    "Z-препараты",
    "Стимуляторы",
    "Анксиолитики",
    "Ингибиторы холинэстеразы / NMDA-антагонисты",
]

DRUGS = [
    # ── SSRIs ──────────────────────────────────────────────────────────────────
    {
        "name": "Флуоксетин",
        "class": "SSRI",
        "mechanism": "Избирательно блокирует обратный захват серотонина (5-HT) в синаптической щели, повышая серотонинергическую передачу.",
        "indications": ["Большое депрессивное расстройство", "ОКР", "Булимия", "Паническое расстройство", "ПТСР"],
        "side_effects": ["Тошнота", "Бессонница", "Сексуальная дисфункция", "Тревога в начале терапии", "Головная боль"],
        "interactions": ["MAOIs (серотониновый синдром)", "Трамадол", "Трициклические антидепрессанты", "Варфарин"],
        "dosage": "20–80 мг/сут, длинный T½ (~1–4 дня), активный метаболит норфлуоксетин T½ ~7–15 дней",
    },
    {
        "name": "Сертралин",
        "class": "SSRI",
        "mechanism": "Мощное избирательное ингибирование обратного захвата серотонина с минимальным влиянием на другие нейромедиаторы.",
        "indications": ["Депрессия", "ОКР", "Паническое расстройство", "ПТСР", "Социальная фобия", "ПМС"],
        "side_effects": ["Диарея", "Тошнота", "Сухость во рту", "Сексуальная дисфункция", "Бессонница"],
        "interactions": ["MAOIs", "Пимозид (строго противопоказан)", "Варфарин"],
        "dosage": "50–200 мг/сут, T½ ~26 ч",
    },
    {
        "name": "Эсциталопрам",
        "class": "SSRI",
        "mechanism": "Наиболее селективный SSRI — S-энантиомер циталопрама; блокирует аллостерический сайт переносчика серотонина.",
        "indications": ["Депрессия", "ГТР", "Паническое расстройство", "Социальное тревожное расстройство", "ОКР"],
        "side_effects": ["Тошнота", "Бессонница", "Сексуальная дисфункция", "Удлинение QTc (доза-зависимое)"],
        "interactions": ["MAOIs", "Удлиняющие QT препараты", "Трамадол"],
        "dosage": "10–20 мг/сут, T½ ~27–32 ч",
    },
    {
        "name": "Пароксетин",
        "class": "SSRI",
        "mechanism": "Ингибирует обратный захват 5-HT + умеренная m-холинолитическая активность; ингибитор CYP2D6.",
        "indications": ["Депрессия", "ОКР", "Паническое расстройство", "Социальная фобия", "ПТСР", "ГТР"],
        "side_effects": ["Прибавка в весе", "Седация", "Сухость во рту", "Запор", "Выраженный синдром отмены"],
        "interactions": ["MAOIs", "Тамоксифен (снижает эффект через CYP2D6)", "ТЦА"],
        "dosage": "20–60 мг/сут, T½ ~21 ч (выраженная нелинейная фармакокинетика)",
    },
    {
        "name": "Флувоксамин",
        "class": "SSRI",
        "mechanism": "Ингибитор SERT; мощный ингибитор CYP1A2 и CYP2C19; минимальная аффинность к другим рецепторам.",
        "indications": ["ОКР (препарат выбора у детей)", "Депрессия", "Социальная фобия", "ПТСР"],
        "side_effects": ["Тошнота (частая)", "Сонливость", "Бессонница", "Сексуальная дисфункция", "Головная боль"],
        "interactions": ["MAOIs", "Клозапин (↑уровень в 5–10 раз)", "Теофиллин", "Варфарин", "Бензодиазепины"],
        "dosage": "50–300 мг/сут, T½ ~15 ч; назначают 1–2 раза в сутки",
    },
    {
        "name": "Циталопрам",
        "class": "SSRI",
        "mechanism": "Высокоселективный ингибитор SERT; рацемическая смесь (S- и R-энантиомеры). R-энантиомер ослабляет эффект S-формы.",
        "indications": ["Депрессия", "Паническое расстройство", "ОКР", "ГТР"],
        "side_effects": ["Тошнота", "Сухость во рту", "Удлинение QTc (ограничение FDA: макс. 40 мг/сут, 20 мг у пожилых)"],
        "interactions": ["MAOIs", "Препараты, удлиняющие QT", "Омепразол (ингибитор CYP2C19)"],
        "dosage": "20–40 мг/сут; T½ ~35 ч",
    },
    # ── SNRIs ──────────────────────────────────────────────────────────────────
    {
        "name": "Венлафаксин",
        "class": "SNRI",
        "mechanism": "При низких дозах — преимущественно ингибирует захват 5-HT; при высоких добавляется ингибирование NE; слабое DA при очень высоких дозах.",
        "indications": ["Депрессия", "ГТР", "Паническое расстройство", "Социальная фобия", "ПТСР"],
        "side_effects": ["Тошнота", "Повышение АД (доза-зависимое)", "Потливость", "Сексуальная дисфункция", "Синдром отмены"],
        "interactions": ["MAOIs", "Трамадол", "Суматриптан"],
        "dosage": "75–375 мг/сут (ER форма), T½ ~5 ч (активный метаболит O-десметилвенлафаксин T½ ~11 ч)",
    },
    {
        "name": "Дулоксетин",
        "class": "SNRI",
        "mechanism": "Сбалансированное ингибирование обратного захвата 5-HT и NE (примерно 1:1 по аффинности).",
        "indications": ["Депрессия", "ГТР", "Нейропатическая боль при диабете", "Фибромиалгия", "Стрессовое недержание мочи"],
        "side_effects": ["Тошнота", "Сухость во рту", "Запор", "Бессонница", "Головокружение"],
        "interactions": ["MAOIs", "Ингибиторы CYP1A2 (флувоксамин)", "Антикоагулянты"],
        "dosage": "60–120 мг/сут, T½ ~12 ч",
    },
    {
        "name": "Десвенлафаксин",
        "class": "SNRI",
        "mechanism": "Активный метаболит венлафаксина (O-десметилвенлафаксин); сбалансированное ингибирование SERT и NET; не метаболизируется через CYP2D6.",
        "indications": ["Большое депрессивное расстройство", "Вазомоторные симптомы менопаузы (off-label)"],
        "side_effects": ["Тошнота", "Головокружение", "Бессонница", "Потливость", "Сексуальная дисфункция"],
        "interactions": ["MAOIs", "Трамадол", "Препараты, метаболизируемые через CYP3A4"],
        "dosage": "50 мг/сут (фиксированная доза при депрессии), T½ ~11 ч",
    },
    {
        "name": "Милнаципран",
        "class": "SNRI",
        "mechanism": "Ингибирует NE в большей степени, чем 5-HT (соотношение NE:5-HT ≈ 3:1); нет значимых взаимодействий с CYP.",
        "indications": ["Фибромиалгия (FDA-одобрен)", "Депрессия (вне США)"],
        "side_effects": ["Тошнота", "Потливость", "Головная боль", "Повышение АД", "Задержка мочи"],
        "interactions": ["MAOIs", "Дигоксин (ортостатическая гипотензия при в/в)", "Адреналин/норадреналин"],
        "dosage": "50–100 мг 2 раза в сутки при фибромиалгии; T½ ~8 ч",
    },
    # ── TCAs ───────────────────────────────────────────────────────────────────
    {
        "name": "Амитриптилин",
        "class": "TCA",
        "mechanism": "Ингибирует обратный захват 5-HT и NE; мощный антагонист H1, m-холинорецепторов и α1-адренорецепторов.",
        "indications": ["Депрессия", "Нейропатическая боль", "Мигрень (профилактика)", "Фибромиалгия", "Энурез у детей"],
        "side_effects": ["Седация", "Сухость во рту", "Запор", "Задержка мочи", "Ортостатическая гипотензия", "Кардиотоксичность при передозировке"],
        "interactions": ["MAOIs", "Антиаритмики", "Антихолинергические препараты", "Алкоголь"],
        "dosage": "75–300 мг/сут, T½ ~10–28 ч",
    },
    {
        "name": "Кломипрамин",
        "class": "TCA",
        "mechanism": "Наиболее мощный ингибитор захвата 5-HT среди ТЦА + значимое NE-ингибирование.",
        "indications": ["ОКР (золотой стандарт среди ТЦА)", "Депрессия", "Паническое расстройство", "Катаплексия"],
        "side_effects": ["Выраженная седация", "Сексуальная дисфункция", "Холинолитические эффекты", "Снижение судорожного порога"],
        "interactions": ["MAOIs", "Серотонинергические препараты", "CYP2D6 ингибиторы"],
        "dosage": "75–250 мг/сут, T½ ~32 ч",
    },
    {
        "name": "Имипрамин",
        "class": "TCA",
        "mechanism": "Ингибирует захват NE (сильнее) и 5-HT + блокада α1, H1, mAChR. Первый синтезированный ТЦА.",
        "indications": ["Депрессия", "Паническое расстройство", "Энурез у детей", "ПТСР (исторически)"],
        "side_effects": ["Ортостатическая гипотензия", "Кардиотоксичность", "Холинолитические эффекты", "Седация"],
        "interactions": ["MAOIs", "Антихолинергические препараты", "Антигипертензивные препараты", "CYP2D6 ингибиторы"],
        "dosage": "75–300 мг/сут, T½ ~8–16 ч (активный метаболит дезипрамин T½ ~12–24 ч)",
    },
    {
        "name": "Нортриптилин",
        "class": "TCA",
        "mechanism": "Активный метаболит амитриптилина; ингибирует захват NE > 5-HT; умеренная холинолитическая активность.",
        "indications": ["Депрессия", "Нейропатическая боль", "Профилактика мигрени", "Синдром раздражённого кишечника"],
        "side_effects": ["Менее выраженная седация, чем у амитриптилина", "Сухость во рту", "Запор", "Ортостатическая гипотензия"],
        "interactions": ["MAOIs", "CYP2D6 ингибиторы", "Антигипертензивные препараты"],
        "dosage": "50–150 мг/сут; оптимальный терапевтический диапазон 50–150 нг/мл; T½ ~18–44 ч",
    },
    {
        "name": "Доксепин",
        "class": "TCA",
        "mechanism": "Мощная блокада H1 (сильнее всех ТЦА) + ингибирование SERT/NET + α1-блокада.",
        "indications": ["Депрессия", "Тревога", "Бессонница (низкие дозы 3–6 мг — FDA-одобрен)", "Зуд (топически)"],
        "side_effects": ["Выраженная седация", "Прибавка в весе", "Антихолинергические эффекты", "Кардиотоксичность"],
        "interactions": ["MAOIs", "Циметидин", "Алкоголь", "ЦНС-депрессанты"],
        "dosage": "75–300 мг/сут при депрессии; 3–6 мг при бессоннице; T½ ~8–24 ч",
    },
    # ── MAOIs ──────────────────────────────────────────────────────────────────
    {
        "name": "Фенелзин",
        "class": "MAOI",
        "mechanism": "Необратимый неселективный ингибитор MAO-A и MAO-B → повышение NE, 5-HT, DA и снижение метаболизма тирамина.",
        "indications": ["Атипичная депрессия", "Социальная фобия", "ПТСР", "Паническое расстройство (рефрактерные случаи)"],
        "side_effects": ["Гипертонический криз при употреблении тирамина", "Ортостатическая гипотензия", "Бессонница", "Прибавка в весе", "Сексуальная дисфункция"],
        "interactions": ["Тираминсодержащие продукты", "Симпатомиметики", "Все серотонинергические препараты", "Опиоиды (особенно меперидин)"],
        "dosage": "45–90 мг/сут в 3 приёма; требуется отмена за 2 недели до других антидепрессантов",
    },
    {
        "name": "Транилципромин",
        "class": "MAOI",
        "mechanism": "Необратимый неселективный ингибитор MAO-A/B; структурно похож на амфетамин — обладает стимулирующим эффектом.",
        "indications": ["Атипичная депрессия", "Рефрактерная депрессия", "Социальная фобия"],
        "side_effects": ["Гипертонический криз (тираминовая реакция)", "Бессонница (стимулирующий эффект)", "Ортостатическая гипотензия", "Гиперрефлексия"],
        "interactions": ["Тирамин", "Все серотонинергические препараты", "Симпатомиметики", "Декстрометорфан"],
        "dosage": "30–60 мг/сут в 2 приёма; T½ ~2–3 ч, но ферментный блок необратим",
    },
    {
        "name": "Моклобемид",
        "class": "MAOI",
        "mechanism": "Обратимый селективный ингибитор MAO-A (RIMA) → менее выраженное взаимодействие с тирамином.",
        "indications": ["Депрессия", "Социальная фобия"],
        "side_effects": ["Тошнота", "Бессонница", "Головокружение", "Меньше холинолитических эффектов"],
        "interactions": ["Серотонинергические препараты", "Симпатомиметики (умеренное ограничение по тирамину)"],
        "dosage": "300–600 мг/сут в 2–3 приёма, T½ ~1–2 ч",
    },
    {
        "name": "Селегилин",
        "class": "MAOI",
        "mechanism": "В низких дозах — необратимый селективный ингибитор MAO-B (↑DA); в высоких — неселективный (↑NE, 5-HT). Трансдермальная форма — системный MAOI.",
        "indications": ["Болезнь Паркинсона (перорально, как адъювант к Л-ДОФА)", "Депрессия (трансдермальный пластырь Emsam — FDA)"],
        "side_effects": ["Бессонница", "Тошнота", "Гипотония", "Реакция на тирамин (только при системном применении)"],
        "interactions": ["Опиоиды (меперидин)", "Серотонинергические препараты (при системных дозах)", "Симпатомиметики"],
        "dosage": "5 мг 2 раза в сутки (при Паркинсоне); трансдермальный: 6–12 мг/24 ч",
    },
    # ── Атипичные антидепрессанты ──────────────────────────────────────────────
    {
        "name": "Бупропион",
        "class": "Атипичные антидепрессанты",
        "mechanism": "Ингибирует обратный захват NE и DA (NDRI); не влияет на 5-HT.",
        "indications": ["Депрессия", "Отказ от курения", "СДВГ (off-label)", "Сезонное аффективное расстройство"],
        "side_effects": ["Бессонница", "Снижение судорожного порога (доза-зависимое)", "Сухость во рту", "Тахикардия", "НЕ вызывает сексуальную дисфункцию"],
        "interactions": ["MAOIs", "Тамоксифен (ингибитор CYP2D6)", "Препараты, снижающие судорожный порог"],
        "dosage": "150–450 мг/сут (SR/XL форма), T½ ~21 ч",
    },
    {
        "name": "Миртазапин",
        "class": "Атипичные антидепрессанты",
        "mechanism": "Антагонист α2-адренорецепторов (пресинаптических) → повышение выброса NE и 5-HT; блокада 5-HT2 и 5-HT3; мощная блокада H1.",
        "indications": ["Депрессия (особенно с бессонницей и сниженным аппетитом)", "ГТР"],
        "side_effects": ["Выраженная седация (особенно при малых дозах)", "Прибавка в весе", "Повышение аппетита", "Агранулоцитоз (редко)"],
        "interactions": ["MAOIs", "Алкоголь (усиление седации)", "Бензодиазепины"],
        "dosage": "15–45 мг/сут (1 раз на ночь), T½ ~20–40 ч",
    },
    {
        "name": "Тразодон",
        "class": "Атипичные антидепрессанты",
        "mechanism": "Антагонист 5-HT2A/2C + слабый ингибитор захвата 5-HT; H1-блокада обусловливает седацию.",
        "indications": ["Депрессия", "Бессонница (sub-терапевтические дозы)", "Тревога"],
        "side_effects": ["Седация", "Ортостатическая гипотензия", "Приапизм (редко, но требует немедленного внимания)", "Головокружение"],
        "interactions": ["MAOIs", "CYP3A4 ингибиторы", "Антигипертензивные препараты"],
        "dosage": "150–600 мг/сут при депрессии; 25–100 мг на ночь при бессоннице",
    },
    {
        "name": "Вортиоксетин",
        "class": "Атипичные антидепрессанты",
        "mechanism": "Мультимодальный: ингибирует SERT + агонист/антагонист 5-HT рецепторов (5-HT1A агонист, 5-HT3/7 антагонист, 5-HT1B частичный агонист).",
        "indications": ["Большое депрессивное расстройство (особенно с когнитивными симптомами)"],
        "side_effects": ["Тошнота (наиболее частая, дозозависимая)", "Запор", "Рвота", "Минимальная сексуальная дисфункция", "Минимальная прибавка в весе"],
        "interactions": ["MAOIs", "Бупропион (ингибитор CYP2D6 — повышает уровень)", "Линезолид"],
        "dosage": "5–20 мг/сут; T½ ~66 ч (длинный)",
    },
    {
        "name": "Агомелатин",
        "class": "Атипичные антидепрессанты",
        "mechanism": "Агонист мелатониновых рецепторов MT1/MT2 + антагонист 5-HT2C → восстановление циркадных ритмов; не ингибирует захват моноаминов.",
        "indications": ["Большое депрессивное расстройство (особенно с нарушением сна)"],
        "side_effects": ["Гепатотоксичность (мониторинг АЛТ/АСТ обязателен!)", "Тошнота", "Головокружение", "Бессонница/сонливость"],
        "interactions": ["Флувоксамин (↑ уровень агомелатина в 60 раз — абсолютно противопоказан)", "CYP1A2 ингибиторы", "Алкоголь"],
        "dosage": "25–50 мг на ночь; T½ ~1–2 ч",
    },
    # ── Типичные антипсихотики ─────────────────────────────────────────────────
    {
        "name": "Галоперидол",
        "class": "Типичные антипсихотики",
        "mechanism": "Мощный антагонист D2-рецепторов в мезолимбическом пути; высокое отношение D2/мускариновая блокада.",
        "indications": ["Шизофрения", "Острые психозы", "Делирий", "Синдром Туретта", "Тяжёлые поведенческие нарушения"],
        "side_effects": ["Экстрапирамидные расстройства (акатизия, дистония, паркинсонизм)", "Поздняя дискинезия", "Нейролептический злокачественный синдром", "Гиперпролактинемия", "Удлинение QTc"],
        "interactions": ["Антихолинергические препараты", "ЦНС-депрессанты", "Препараты, удлиняющие QT", "Антипаркинсонические средства"],
        "dosage": "2–20 мг/сут (пероральный); депо-форма 50–200 мг в/м каждые 4 недели",
    },
    {
        "name": "Хлорпромазин",
        "class": "Типичные антипсихотики",
        "mechanism": "Антагонист D1/D2 + блокада α1, H1, mAChR → широкий спектр нейромедиаторных эффектов.",
        "indications": ["Шизофрения", "Маниакальные эпизоды", "Тяжёлая тошнота/рвота", "Икота"],
        "side_effects": ["Выраженная седация", "Антихолинергические эффекты", "Фотосенсибилизация", "Желтуха", "ЭПС"],
        "interactions": ["Антигипертензивные препараты", "Антихолинергические средства", "Леводопа"],
        "dosage": "100–1000 мг/сут в разделённых дозах",
    },
    {
        "name": "Флуфеназин",
        "class": "Типичные антипсихотики",
        "mechanism": "Высокоселективный D2-антагонист; минимальные холинолитические и H1-блокирующие эффекты.",
        "indications": ["Шизофрения", "Психотические расстройства (поддерживающая терапия)", "Тиковые расстройства"],
        "side_effects": ["Выраженные ЭПС", "Поздняя дискинезия", "Акатизия", "Гиперпролактинемия"],
        "interactions": ["Антихолинергические препараты (уменьшают ЭПС)", "ЦНС-депрессанты", "Препараты, снижающие судорожный порог"],
        "dosage": "2–40 мг/сут (пероральный); депо-форма деканоат 12.5–50 мг в/м каждые 2–4 недели",
    },
    # ── Атипичные антипсихотики ────────────────────────────────────────────────
    {
        "name": "Оланзапин",
        "class": "Атипичные антипсихотики",
        "mechanism": "Антагонист D2, 5-HT2A, H1, α1, mAChR. Более высокое отношение 5-HT2A/D2 блокады по сравнению с типичными.",
        "indications": ["Шизофрения", "Биполярная мания (острая)", "Биполярное расстройство (поддерживающая терапия)", "Анорексия (off-label)"],
        "side_effects": ["Выраженная прибавка в весе", "Метаболический синдром", "Гипергликемия/диабет 2 типа", "Седация", "Минимальные ЭПС"],
        "interactions": ["Флувоксамин (повышает уровень)", "Карбамазепин (снижает уровень)", "Антидиабетические препараты"],
        "dosage": "5–20 мг/сут, T½ ~30 ч",
    },
    {
        "name": "Клозапин",
        "class": "Атипичные антипсихотики",
        "mechanism": "Широкий полирецепторный антагонизм (D1-4, 5-HT, H1, α, mAChR); уникальная эффективность при рефрактерной шизофрении.",
        "indications": ["Рефрактерная шизофрения", "Суицидальность при шизофрении/шизоаффективном расстройстве"],
        "side_effects": ["Агранулоцитоз (требует мониторинга ОАК)", "Миокардит", "Судороги (доза-зависимые)", "Гиперсаливация", "Выраженная прибавка в весе", "Ортостатическая гипотензия"],
        "interactions": ["CYP1A2 ингибиторы/индукторы (курение!)", "Бензодиазепины (риск остановки дыхания)", "Препараты, угнетающие кроветворение"],
        "dosage": "150–600 мг/сут, T½ ~12 ч; титрование обязательно",
    },
    {
        "name": "Рисперидон",
        "class": "Атипичные антипсихотики",
        "mechanism": "Антагонист D2 и 5-HT2A (высокое сродство); также блокирует α1 и H1.",
        "indications": ["Шизофрения", "Биполярная мания", "Раздражительность при аутизме"],
        "side_effects": ["Гиперпролактинемия (выраженная)", "ЭПС при высоких дозах", "Прибавка в весе", "Ортостатическая гипотензия"],
        "interactions": ["CYP2D6 ингибиторы (пароксетин)", "Антигипертензивные препараты", "Карбамазепин"],
        "dosage": "2–16 мг/сут, T½ ~20 ч (+ активный метаболит 9-гидроксирисперидон)",
    },
    {
        "name": "Арипипразол",
        "class": "Атипичные антипсихотики",
        "mechanism": "Частичный агонист D2 и 5-HT1A; антагонист 5-HT2A — «стабилизатор допамина».",
        "indications": ["Шизофрения", "Биполярное расстройство (мания и поддерживающая терапия)", "Дополнение к антидепрессантам при депрессии"],
        "side_effects": ["Акатизия (довольно частая)", "Тошнота", "Бессонница", "Минимальная прибавка в весе", "Минимальная гиперпролактинемия"],
        "interactions": ["CYP2D6/3A4 ингибиторы", "Карбамазепин (индукция снижает уровень)"],
        "dosage": "10–30 мг/сут, T½ ~75 ч (длинный!)",
    },
    {
        "name": "Кветиапин",
        "class": "Атипичные антипсихотики",
        "mechanism": "Антагонист D2, 5-HT2A, H1, α1; слабая D2-блокада при низких дозах.",
        "indications": ["Шизофрения", "Биполярная мания/депрессия", "Дополнение при депрессии (низкие дозы)", "Бессонница (off-label, низкие дозы)"],
        "side_effects": ["Выраженная седация", "Прибавка в весе", "Метаболический синдром", "Катаракта (требует офтальмологического контроля)"],
        "interactions": ["CYP3A4 ингибиторы/индукторы", "Антигипертензивные препараты", "Тиоридазин"],
        "dosage": "150–750 мг/сут при психозе; 50–300 мг при депрессии/биполярном расстройстве",
    },
    {
        "name": "Луразидон",
        "class": "Атипичные антипсихотики",
        "mechanism": "Антагонист D2, 5-HT2A, 5-HT7; агонист 5-HT1A; минимальная блокада H1 и mAChR → минимальные метаболические эффекты.",
        "indications": ["Шизофрения", "Биполярная депрессия (с/без лития или вальпроата)", "Депрессивные эпизоды при БАС I типа"],
        "side_effects": ["Акатизия", "Паркинсонизм", "Тошнота", "Сонливость", "Минимальная прибавка в весе", "Минимальный метаболический эффект"],
        "interactions": ["Сильные ингибиторы CYP3A4 (кетоконазол — противопоказан)", "Сильные индукторы CYP3A4 (рифампицин — противопоказан)", "Грейпфрутовый сок"],
        "dosage": "40–160 мг/сут, принимать с едой (≥350 ккал), T½ ~18 ч",
    },
    {
        "name": "Зипразидон",
        "class": "Атипичные антипсихотики",
        "mechanism": "Антагонист D2/D3, 5-HT2A, 5-HT2C; агонист 5-HT1A; ингибирует захват 5-HT и NE.",
        "indications": ["Шизофрения", "Биполярная мания (острая, пероральная и в/м форма)", "Ажитация (в/м)"],
        "side_effects": ["Удлинение QTc (требует ЭКГ-мониторинга)", "Сонливость", "Головокружение", "Минимальная прибавка в весе"],
        "interactions": ["Препараты, удлиняющие QT (класс I/III антиаритмики, хинолоны)", "CYP3A4 ингибиторы", "Антигипертензивные препараты"],
        "dosage": "40–160 мг/сут (с едой); в/м 10–20 мг; T½ ~7 ч",
    },
    {
        "name": "Палиперидон",
        "class": "Атипичные антипсихотики",
        "mechanism": "Активный метаболит рисперидона (9-гидроксирисперидон); антагонист D2, 5-HT2A, α1, H1; не метаболизируется через CYP (выводится почками).",
        "indications": ["Шизофрения", "Шизоаффективное расстройство"],
        "side_effects": ["Гиперпролактинемия", "ЭПС", "Тахикардия", "Ортостатическая гипотензия"],
        "interactions": ["Антигипертензивные препараты", "Карбамазепин (снижает уровень на 37%)", "Леводопа"],
        "dosage": "3–12 мг/сут; депо-форма Инвега Сустенна 39–234 мг в/м 1 раз в месяц; T½ ~23 ч",
    },
    # ── Стабилизаторы настроения ───────────────────────────────────────────────
    {
        "name": "Лития карбонат",
        "class": "Стабилизаторы настроения",
        "mechanism": "Точный механизм неизвестен; ингибирует инозитолмонофосфатазу (истощение инозитола), модулирует GSK-3β, нейротрофические факторы.",
        "indications": ["Биполярное расстройство (острая мания и профилактика)", "Рекуррентная депрессия (аугментация)", "Суицидальность"],
        "side_effects": ["Тремор", "Полиурия/полидипсия (нефрогенный несахарный диабет)", "Гипотиреоз", "Угревая сыпь", "Тератогенность (аномалия Эбштейна)"],
        "interactions": ["НПВС (повышают уровень лития)", "Тиазидные диуретики", "АПФ-ингибиторы", "Нейролептики"],
        "dosage": "Терапевтический диапазон: 0.6–1.2 ммоль/л (острая мания до 1.5); мониторинг уровня, ТТГ, функции почек",
    },
    {
        "name": "Вальпроат",
        "class": "Стабилизаторы настроения",
        "mechanism": "Блокирует Na+-каналы (инактивированное состояние); усиливает ГАМК-ергическую передачу; ингибирует гистондеацетилазу.",
        "indications": ["Биполярная мания (острая и профилактика)", "Эпилепсия (разные формы)", "Мигрень (профилактика)"],
        "side_effects": ["Тератогенность (дефекты нервной трубки, нарушения развития!)", "Панкреатит", "Гепатотоксичность", "Тромбоцитопения", "Прибавка в весе", "Выпадение волос"],
        "interactions": ["Ламотриджин (удваивает T½)", "Аспирин", "Карбамазепин", "Фенитоин"],
        "dosage": "750–2500 мг/сут; терапевтический уровень 50–125 мкг/мл",
    },
    {
        "name": "Ламотриджин",
        "class": "Стабилизаторы настроения",
        "mechanism": "Блокирует Na+-каналы в возбуждённом состоянии → уменьшает высвобождение возбуждающих нейромедиаторов (глутамат, аспартат).",
        "indications": ["Биполярное расстройство (профилактика депрессивных фаз)", "Эпилепсия"],
        "side_effects": ["Синдром Стивенса–Джонсона (при быстрой титрации!)", "Сыпь", "Диплопия", "Головокружение", "Бессонница"],
        "interactions": ["Вальпроат (удваивает уровень ламотриджина)", "Карбамазепин (снижает уровень)", "Гормональные контрацептивы (снижают уровень)"],
        "dosage": "100–400 мг/сут; ОБЯЗАТЕЛЬНАЯ медленная титрация (снижает риск сыпи)",
    },
    {
        "name": "Карбамазепин",
        "class": "Стабилизаторы настроения",
        "mechanism": "Блокирует Na+-каналы в инактивированном состоянии; снижает нейрональную возбудимость; мощный индуктор CYP3A4, CYP1A2, CYP2C.",
        "indications": ["Биполярная мания (альтернатива литию)", "Эпилепсия (парциальные припадки)", "Тригеминальная невралгия"],
        "side_effects": ["Диплопия и атаксия (дозозависимые)", "Гипонатриемия (SIADH)", "Агранулоцитоз/апластическая анемия (редко)", "Синдром Стивенса–Джонсона (у носителей HLA-B*1502 — азиаты)", "Тератогенность"],
        "interactions": ["Оральные контрацептивы (снижает эффективность)", "Вальпроат", "Ламотриджин", "Многие препараты из-за индукции CYP"],
        "dosage": "400–1600 мг/сут в 2–4 приёма; терапевтический уровень 4–12 мкг/мл; T½ ~36 ч (затем снижается из-за ауторедукции до 12–17 ч)",
    },
    # ── Бензодиазепины ─────────────────────────────────────────────────────────
    {
        "name": "Диазепам",
        "class": "Бензодиазепины",
        "mechanism": "Аллостерический положительный модулятор ГАМК-А рецепторов → усиление тока Cl⁻ → гиперполяризация.",
        "indications": ["Тревожные расстройства", "Эпилептический статус", "Синдром отмены алкоголя", "Мышечный спазм", "Преоперационная премедикация"],
        "side_effects": ["Седация", "Когнитивные нарушения", "Зависимость/толерантность", "Синдром отмены", "Угнетение дыхания"],
        "interactions": ["Алкоголь", "Опиоиды (риск остановки дыхания)", "ЦНС-депрессанты", "Флумазенил (антидот)"],
        "dosage": "2–10 мг 2–4 раза в сутки при тревоге; T½ ~20–100 ч (длинный, активные метаболиты)",
    },
    {
        "name": "Лоразепам",
        "class": "Бензодиазепины",
        "mechanism": "Аллостерический модулятор ГАМК-А; высокое сродство к рецептору.",
        "indications": ["Тревога", "Острая паника", "Эпилептический статус (в/в)", "Премедикация", "Острые психозы (в/м)"],
        "side_effects": ["Седация", "Антероградная амнезия", "Угнетение дыхания", "Зависимость"],
        "interactions": ["Алкоголь", "Клозапин (риск тяжёлой гипотензии при в/м введении)", "ЦНС-депрессанты"],
        "dosage": "0.5–4 мг/сут; T½ ~10–20 ч (без активных метаболитов — удобен при печёночной патологии)",
    },
    {
        "name": "Клоназепам",
        "class": "Бензодиазепины",
        "mechanism": "Аллостерический модулятор ГАМК-А; выраженная анксиолитическая и противоэпилептическая активность.",
        "indications": ["Паническое расстройство", "Социальная фобия (краткосрочно)", "Эпилепсия", "Акатизия (от антипсихотиков)"],
        "side_effects": ["Седация", "Когнитивные нарушения", "Депрессия", "Зависимость"],
        "interactions": ["ЦНС-депрессанты", "Вальпроат", "Алкоголь"],
        "dosage": "0.5–4 мг/сут в 2–3 приёма; T½ ~18–50 ч",
    },
    {
        "name": "Алпразолам",
        "class": "Бензодиазепины",
        "mechanism": "Аллостерический модулятор ГАМК-А; мощный препарат с быстрым началом действия.",
        "indications": ["Паническое расстройство", "Тревожные расстройства", "Агорафобия"],
        "side_effects": ["Зависимость (выраженная)", "Синдром отмены (сильный)", "Седация", "Когнитивные нарушения"],
        "interactions": ["CYP3A4 ингибиторы (значительно повышают уровень)", "Алкоголь", "Опиоиды"],
        "dosage": "0.25–4 мг/сут в 3–4 приёма; XR форма; T½ ~11–15 ч",
    },
    # ── Z-препараты ────────────────────────────────────────────────────────────
    {
        "name": "Золпидем",
        "class": "Z-препараты",
        "mechanism": "Селективный агонист ГАМК-А рецепторов, содержащих субъединицу α1 (отвечает за седацию, менее — за тревогу/миорелаксацию).",
        "indications": ["Бессонница (краткосрочная)"],
        "side_effects": ["Парасомнии (лунатизм, вождение во сне)", "Когнитивные нарушения", "Антероградная амнезия", "Зависимость (меньше, чем бензодиазепины)"],
        "interactions": ["Алкоголь", "ЦНС-депрессанты", "CYP3A4 ингибиторы"],
        "dosage": "5–10 мг перед сном; T½ ~2.5 ч (короткий)",
    },
    {
        "name": "Зопиклон",
        "class": "Z-препараты",
        "mechanism": "Агонист ГАМК-А (не такой селективный по α1, как золпидем); действует на хлоридный канал аналогично бензодиазепинам.",
        "indications": ["Бессонница (краткосрочная)", "Трудности засыпания и поддержания сна"],
        "side_effects": ["Металлический/горький привкус во рту (характерный побочный эффект)", "Седация", "Зависимость", "Антероградная амнезия"],
        "interactions": ["Алкоголь (усиление угнетения ЦНС)", "CYP3A4 ингибиторы/индукторы", "ЦНС-депрессанты"],
        "dosage": "3.75–7.5 мг перед сном; T½ ~5 ч",
    },
    # ── Стимуляторы ────────────────────────────────────────────────────────────
    {
        "name": "Метилфенидат",
        "class": "Стимуляторы",
        "mechanism": "Блокирует обратный захват DA и NE (преимущественно DA) в префронтальной коре и стриатуме.",
        "indications": ["СДВГ (у детей и взрослых)", "Нарколепсия"],
        "side_effects": ["Снижение аппетита", "Бессонница", "Тахикардия", "Повышение АД", "Задержка роста у детей при длительном применении"],
        "interactions": ["MAOIs", "Антигипертензивные препараты", "Антикоагулянты"],
        "dosage": "5–60 мг/сут в разделённых дозах (IR) или 18–72 мг/сут (ER/OROS), T½ ~2–3 ч (IR)",
    },
    {
        "name": "Атомоксетин",
        "class": "Стимуляторы",
        "mechanism": "Избирательный ингибитор обратного захвата NE (не является контролируемым веществом в отличие от стимуляторов).",
        "indications": ["СДВГ (взрослые и дети ≥6 лет)", "Тревожные расстройства при СДВГ"],
        "side_effects": ["Тошнота", "Снижение аппетита", "Бессонница", "Гепатотоксичность (редко)", "Суицидальные мысли (чёрная рамка у детей)"],
        "interactions": ["MAOIs (строго противопоказаны)", "CYP2D6 ингибиторы (пароксетин, флуоксетин)"],
        "dosage": "40–100 мг/сут (1–2 раза в сутки), T½ ~5 ч у быстрых метаболизаторов по CYP2D6",
    },
    {
        "name": "Амфетамин (смешанные соли)",
        "class": "Стимуляторы",
        "mechanism": "Высвобождает DA и NE из везикул (обратный транспорт через DAT/NET); также ингибирует MAO. Более мощный эффект на DA, чем метилфенидат.",
        "indications": ["СДВГ", "Нарколепсия", "Ожирение (краткосрочно, off-label)"],
        "side_effects": ["Зависимость (высокий потенциал)", "Снижение аппетита", "Бессонница", "Тахикардия", "Повышение АД", "Психоз (при злоупотреблении)"],
        "interactions": ["MAOIs (гипертонический криз + серотониновый синдром)", "Антигипертензивные препараты", "Антациды (замедляют выведение)"],
        "dosage": "5–60 мг/сут (IR); XR форма 5–30 мг/сут; T½ ~11 ч",
    },
    # ── Анксиолитики ───────────────────────────────────────────────────────────
    {
        "name": "Буспирон",
        "class": "Анксиолитики",
        "mechanism": "Частичный агонист 5-HT1A (пресинаптический → снижение серотонинергической передачи; постсинаптический → анксиолитический эффект); слабый антагонист D2.",
        "indications": ["ГТР (препарат выбора для длительной терапии)", "Тревожные расстройства"],
        "side_effects": ["Головокружение", "Тошнота", "Головная боль", "Беспокойство в начале терапии", "Нет седации, нет зависимости"],
        "interactions": ["MAOIs (осторожно)", "CYP3A4 ингибиторы (итраконазол — ↑уровень буспирона)", "Вейн-янь — высококонцентрированный CYP3A4 индуктор"],
        "dosage": "15–60 мг/сут в 2–3 приёма; T½ ~2–3 ч; НАЧАЛО ЭФФЕКТА через 2–4 недели",
    },
    {
        "name": "Гидроксизин",
        "class": "Анксиолитики",
        "mechanism": "Антагонист H1-рецепторов первого поколения (ЦНС-проникающий) → седация и анксиолиз; антагонист мускариновых рецепторов.",
        "indications": ["Тревога (краткосрочная)", "Зуд (антигистаминный эффект)", "Премедикация", "Синдром отмены алкоголя (вспомогательная роль)"],
        "side_effects": ["Седация", "Сухость во рту", "Задержка мочи", "Удлинение QTc", "Когнитивные нарушения у пожилых"],
        "interactions": ["ЦНС-депрессанты", "Алкоголь", "Препараты, удлиняющие QT"],
        "dosage": "25–100 мг 3–4 раза в сутки; T½ ~20 ч",
    },
    {
        "name": "Прегабалин",
        "class": "Анксиолитики",
        "mechanism": "Связывается с α2δ-субъединицей потенциалзависимых Ca²+-каналов → снижает высвобождение возбуждающих нейромедиаторов (глутамата, субстанции Р).",
        "indications": ["ГТР (европейское одобрение)", "Нейропатическая боль", "Фибромиалгия", "Эпилепсия (адъювант)"],
        "side_effects": ["Сонливость", "Головокружение", "Периферические отёки", "Прибавка в весе", "Риск зависимости (умеренный)"],
        "interactions": ["Алкоголь", "ЦНС-депрессанты", "Тиазолидиндионы (отёки)"],
        "dosage": "150–600 мг/сут в 2–3 приёма; T½ ~6 ч",
    },
    # ── Ингибиторы ХЭ / NMDA-антагонисты ─────────────────────────────────────
    {
        "name": "Донепезил",
        "class": "Ингибиторы холинэстеразы / NMDA-антагонисты",
        "mechanism": "Обратимый неконкурентный ингибитор ацетилхолинэстеразы (AChE) → накопление АЦХ в синаптической щели → компенсирует дефицит холинергической передачи при болезни Альцгеймера.",
        "indications": ["Болезнь Альцгеймера (лёгкая–тяжёлая стадии)", "Деменция при болезни Паркинсона"],
        "side_effects": ["Тошнота", "Диарея", "Мышечные судороги (холинергические)", "Брадикардия", "Бессонница (принимать утром)", "Синкопе"],
        "interactions": ["Холинолитики (антагонизм)", "Бета-блокаторы (брадикардия)", "НПВС (ЖКТ-риск)", "CYP3A4/2D6 ингибиторы"],
        "dosage": "5–10 мг 1 раз в сутки (начинать с 5 мг); T½ ~70 ч",
    },
    {
        "name": "Ривастигмин",
        "class": "Ингибиторы холинэстеразы / NMDA-антагонисты",
        "mechanism": "Псевдонеобратимый ингибитор AChE и бутирилхолинэстеразы (BChE); действует в ЦНС и периферии.",
        "indications": ["Болезнь Альцгеймера", "Деменция при болезни Паркинсона (единственный одобренный ингибитор ХЭ)"],
        "side_effects": ["Тошнота и рвота (часто)", "Снижение веса", "Головокружение", "Реакция в месте нанесения пластыря"],
        "interactions": ["Холинолитики (антагонизм)", "Бета-блокаторы (↑риск брадикардии)"],
        "dosage": "Пероральный: 3–12 мг/сут в 2 приёма; трансдермальный пластырь: 4.6–13.3 мг/24 ч (предпочтительнее — меньше ЖКТ-эффектов)",
    },
    {
        "name": "Мемантин",
        "class": "Ингибиторы холинэстеразы / NMDA-антагонисты",
        "mechanism": "Неконкурентный антагонист NMDA-рецепторов (умеренно-низкое сродство, зависимое от напряжения) → защита от эксайтотоксичности глутамата.",
        "indications": ["Болезнь Альцгеймера (умеренная–тяжёлая стадии)", "Часто комбинируют с донепезилом"],
        "side_effects": ["Головокружение", "Головная боль", "Запор", "Спутанность (редко)", "Хорошо переносится в целом"],
        "interactions": ["Амантадин (NMDA-антагонизм — риск психоза)", "Ингибиторы почечной экскреции (диакарб)", "Кетамин"],
        "dosage": "5–20 мг/сут в 1–2 приёма (медленная титрация); T½ ~60–80 ч",
    },
]


# ── Pre-built lookup caches (populated once on module import) ──────────────────

_DRUG_BY_NAME: dict[str, dict] = {}
_DRUGS_BY_CLASS: dict[str, list] = {}

for _drug in DRUGS:
    _DRUG_BY_NAME[_drug["name"].lower()] = _drug
    _DRUGS_BY_CLASS.setdefault(_drug["class"], []).append(_drug)


def get_drugs_by_class(drug_class: str) -> list:
    return _DRUGS_BY_CLASS.get(drug_class, [])


def get_drug_by_name(name: str) -> dict | None:
    """Получить информацию о препарате по названию."""
    from exceptions import DrugNotFoundError
    drug = _DRUG_BY_NAME.get(name.lower())
    if not drug:
        raise DrugNotFoundError(f"Препарат '{name}' не найден")
    return drug


def search_drugs(query: str) -> list:
    q = query.lower()
    results = []
    for d in DRUGS:
        if (q in d["name"].lower()
                or q in d["class"].lower()
                or q in d["mechanism"].lower()
                or any(q in ind.lower() for ind in d["indications"])):
            results.append(d)
    return results


def fuzzy_suggest(query: str, max_results: int = 5) -> list[str]:
    """Return drug names that are close matches to *query* (for 'did you mean?' hints)."""
    from difflib import get_close_matches
    all_names = [d["name"] for d in DRUGS]
    return get_close_matches(query, all_names, n=max_results, cutoff=0.45)
