"""Quiz questions for psychopharmacology tutor bot."""

CATEGORIES = ["Механизмы действия", "Показания", "Побочные эффекты", "Взаимодействия", "Фармакокинетика"]

QUESTIONS = [
    # Mechanisms of action
    {
        "question": "Какой механизм действия характерен для SSRI?",
        "options": [
            "Ингибирование обратного захвата серотонина",
            "Блокада D2-рецепторов",
            "Антагонизм NMDA-рецепторов",
            "Ингибирование МАО",
        ],
        "correct": 0,
        "explanation": "SSRI (селективные ингибиторы обратного захвата серотонина) блокируют SERT — переносчик серотонина, повышая его концентрацию в синаптической щели.",
        "category": "Механизмы действия",
        "difficulty": "easy",
    },
    {
        "question": "Бупропион относится к классу NDRI. Что это означает?",
        "options": [
            "Ингибирует обратный захват норэпинефрина и дофамина",
            "Блокирует норадреналиновые рецепторы",
            "Ингибирует обратный захват серотонина и дофамина",
            "Антагонист дофаминовых и норадреналиновых рецепторов",
        ],
        "correct": 0,
        "explanation": "NDRI = Norepinephrine-Dopamine Reuptake Inhibitor. Бупропион блокирует переносчики NE (NET) и DA (DAT), не влияя на серотонин — что объясняет отсутствие сексуальной дисфункции.",
        "category": "Механизмы действия",
        "difficulty": "easy",
    },
    {
        "question": "Какой механизм делает клозапин уникальным среди антипсихотиков?",
        "options": [
            "Широкий полирецепторный антагонизм (D1-4, 5-HT, H1, α, mAChR)",
            "Исключительно D2-блокада",
            "Частичный агонизм D2",
            "Ингибирование МАО-В",
        ],
        "correct": 0,
        "explanation": "Клозапин блокирует множество рецепторов. Низкое сродство к D2 и высокое к D4/5-HT рецепторам объясняют эффективность при рефрактерной шизофрении и минимальные ЭПС.",
        "category": "Механизмы действия",
        "difficulty": "medium",
    },
    {
        "question": "Как миртазапин повышает серотонинергическую и норадренергическую передачу?",
        "options": [
            "Блокирует пресинаптические α2-ауторецепторы, снимая тормозной контроль",
            "Ингибирует обратный захват серотонина и норэпинефрина",
            "Активирует 5-HT1A постсинаптические рецепторы",
            "Ингибирует МАО-А",
        ],
        "correct": 0,
        "explanation": "α2-ауторецепторы — пресинаптический 'тормоз' для высвобождения NE и 5-HT. Блокируя их, миртазапин снимает это торможение, усиливая выброс обоих медиаторов.",
        "category": "Механизмы действия",
        "difficulty": "hard",
    },
    {
        "question": "Арипипразол отличается от типичных антипсихотиков тем, что он является:",
        "options": [
            "Частичным агонистом D2-рецепторов",
            "Полным антагонистом D2",
            "Полным агонистом D2",
            "Антагонистом D1-рецепторов",
        ],
        "correct": 0,
        "explanation": "Арипипразол — 'стабилизатор дофамина': в условиях гиперактивности DA (мезолимбический путь) действует как антагонист, в условиях гиподофаминергии (мезокортикальный путь) — как частичный агонист.",
        "category": "Механизмы действия",
        "difficulty": "medium",
    },
    {
        "question": "Каков механизм противоэпилептического действия вальпроата?",
        "options": [
            "Блокада Na+-каналов и усиление ГАМК-ергической передачи",
            "Только блокада Ca²+-каналов",
            "Антагонизм NMDA-рецепторов",
            "Ингибирование карбоангидразы",
        ],
        "correct": 0,
        "explanation": "Вальпроат работает через несколько механизмов: блокирует Na+-каналы в инактивированном состоянии, ингибирует ГАМК-трансаминазу (повышая уровень ГАМК) и ингибирует гистондеацетилазу.",
        "category": "Механизмы действия",
        "difficulty": "medium",
    },
    {
        "question": "Что такое RIMA и чем моклобемид отличается от фенелзина?",
        "options": [
            "Обратимый ингибитор МАО-А — меньше взаимодействует с тирамином",
            "Необратимый ингибитор МАО-В — безопасен с тирамином",
            "Необратимый ингибитор МАО-А и МАО-В",
            "Частичный агонист МАО-А",
        ],
        "correct": 0,
        "explanation": "RIMA = Reversible Inhibitor of MAO-A. Обратимость позволяет тирамину вытеснять моклобемид с фермента, снижая риск гипертонического криза. Фенелзин — необратимый MAOI.",
        "category": "Механизмы действия",
        "difficulty": "hard",
    },
    # Indications
    {
        "question": "Какой препарат является препаратом выбора при рефрактерной шизофрении?",
        "options": ["Клозапин", "Галоперидол", "Рисперидон", "Кветиапин"],
        "correct": 0,
        "explanation": "Клозапин — единственный антипсихотик с доказанной эффективностью при шизофрении, резистентной к ≥2 препаратам. Также снижает риск суицида при шизофрении.",
        "category": "Показания",
        "difficulty": "easy",
    },
    {
        "question": "При каком состоянии флуоксетин НЕ имеет одобренного показания?",
        "options": ["Биполярная депрессия (монотерапия)", "Большое депрессивное расстройство", "ОКР", "Булимия"],
        "correct": 0,
        "explanation": "Монотерапия SSRI при биполярной депрессии может спровоцировать манию или ускорить цикличность. Флуоксетин одобрен только в комбинации с оланзапином (Symbyax) для биполярной депрессии.",
        "category": "Показания",
        "difficulty": "medium",
    },
    {
        "question": "Литий одобрен для длительной профилактики при:",
        "options": [
            "Биполярном расстройстве I типа",
            "Шизофрении",
            "Большом депрессивном расстройстве (монотерапия)",
            "ПТСР",
        ],
        "correct": 0,
        "explanation": "Литий остаётся gold standard для профилактики маниакальных и депрессивных фаз при биполярном расстройстве, а также снижает риск суицида.",
        "category": "Показания",
        "difficulty": "easy",
    },
    {
        "question": "Атомоксетин при СДВГ отличается от метилфенидата тем, что:",
        "options": [
            "Не является контролируемым веществом",
            "Действует быстрее",
            "Имеет более высокую эффективность",
            "Одобрен только у взрослых",
        ],
        "correct": 0,
        "explanation": "Атомоксетин — SNRI без дофаминергического компонента, не входит в списки психотропных/наркотических веществ. Полный эффект развивается через 2–4 недели (как у антидепрессантов).",
        "category": "Показания",
        "difficulty": "medium",
    },
    {
        "question": "Ламотриджин при биполярном расстройстве наиболее эффективен для профилактики:",
        "options": ["Депрессивных эпизодов", "Маниакальных эпизодов", "Смешанных состояний", "Психотических симптомов"],
        "correct": 0,
        "explanation": "Ламотриджин значительно лучше предотвращает депрессивные фазы, чем маниакальные. Для острой мании не эффективен.",
        "category": "Показания",
        "difficulty": "medium",
    },
    {
        "question": "Тразодон в субтерапевтических дозах (25–100 мг) часто назначают при:",
        "options": ["Бессоннице", "Биполярной мании", "Шизофрении", "СДВГ"],
        "correct": 0,
        "explanation": "Мощная блокада H1 и 5-HT2 обусловливает выраженный снотворный эффект. При этом дозы для лечения депрессии (150–600 мг) значительно выше.",
        "category": "Показания",
        "difficulty": "easy",
    },
    # Side effects
    {
        "question": "Какой серьёзный гематологический побочный эффект требует еженедельного мониторинга ОАК при приёме клозапина?",
        "options": ["Агранулоцитоз", "Тромбоцитопения", "Апластическая анемия", "Эозинофилия"],
        "correct": 0,
        "explanation": "Агранулоцитоз (снижение нейтрофилов <500/мкл) развивается у ~1% пациентов и потенциально смертелен. Требует регулярного ОАК и немедленной отмены при нейтропении.",
        "category": "Побочные эффекты",
        "difficulty": "easy",
    },
    {
        "question": "Синдром Стивенса–Джонсона наиболее часто связан с:",
        "options": ["Быстрой титрацией ламотриджина", "Передозировкой лития", "Отменой бензодиазепинов", "Приёмом клозапина"],
        "correct": 0,
        "explanation": "Медленная титрация ламотриджина резко снижает риск кожных реакций. Вальпроат удваивает уровень ламотриджина и при совместном применении требует ещё более медленного наращивания дозы.",
        "category": "Побочные эффекты",
        "difficulty": "medium",
    },
    {
        "question": "Пациент на фенелзине съел выдержанный сыр. Какое осложнение наиболее вероятно?",
        "options": [
            "Гипертонический криз",
            "Серотониновый синдром",
            "Агранулоцитоз",
            "Нейролептический злокачественный синдром",
        ],
        "correct": 0,
        "explanation": "Тирамин в выдержанных сырах, вине, копчёностях в норме разрушается MAO. При ингибировании MAO тирамин всасывается и вызывает массивный выброс норэпинефрина → гипертонический криз.",
        "category": "Побочные эффекты",
        "difficulty": "medium",
    },
    {
        "question": "Какой атипичный антипсихотик вызывает наибольшую прибавку в весе?",
        "options": ["Оланзапин", "Арипипразол", "Зипразидон", "Луразидон"],
        "correct": 0,
        "explanation": "Оланзапин и клозапин вызывают наиболее выраженную прибавку в весе среди всех антипсихотиков (в среднем 4–5 кг за 10 недель). Арипипразол, зипразидон и луразидон — метаболически нейтральные.",
        "category": "Побочные эффекты",
        "difficulty": "easy",
    },
    {
        "question": "Поздняя дискинезия — это:",
        "options": [
            "Непроизвольные ритмичные движения (губы, язык) при длительном приёме антипсихотиков",
            "Острый мышечный спазм в начале лечения",
            "Субъективное двигательное беспокойство",
            "Синдром, неотличимый от паркинсонизма",
        ],
        "correct": 0,
        "explanation": "Поздняя дискинезия возникает при длительной D2-блокаде (месяцы–годы) из-за рецепторной сверхчувствительности. Часто необратима. Типичные антипсихотики > атипичных по риску.",
        "category": "Побочные эффекты",
        "difficulty": "medium",
    },
    {
        "question": "Пароксетин вызывает выраженный синдром отмены по сравнению с флуоксетином потому, что:",
        "options": [
            "Имеет очень короткий период полувыведения и нет активных метаболитов",
            "Является сильным ингибитором CYP2D6",
            "Обладает холинолитическим эффектом",
            "Быстро метаболизируется CYP3A4",
        ],
        "correct": 0,
        "explanation": "T½ пароксетина ~21 ч без активных метаболитов. Флуоксетин имеет T½ 1–4 дня + активный метаболит норфлуоксетин T½ 7–15 дней — фактически самоотменяется постепенно.",
        "category": "Побочные эффекты",
        "difficulty": "hard",
    },
    {
        "question": "Приапизм — редкий, но требующий немедленной помощи побочный эффект:",
        "options": ["Тразодона", "Флуоксетина", "Клозапина", "Лития"],
        "correct": 0,
        "explanation": "Тразодон блокирует α1-адренорецепторы, что может вызвать приапизм (болезненная стойкая эрекция). Уролог. экстренная помощь необходима в течение 4–6 часов.",
        "category": "Побочные эффекты",
        "difficulty": "medium",
    },
    # Drug interactions
    {
        "question": "Комбинация MAOI + меперидин (петидин) может вызвать:",
        "options": [
            "Серотониновый синдром и смерть",
            "Гипертонический криз",
            "Агранулоцитоз",
            "Нейролептический злокачественный синдром",
        ],
        "correct": 0,
        "explanation": "Меперидин ингибирует захват серотонина. Совместно с MAOI это вызывает тяжёлый серотониновый синдром. Все опиоиды при MAOI опасны (кроме морфина/кодеина с осторожностью).",
        "category": "Взаимодействия",
        "difficulty": "medium",
    },
    {
        "question": "НПВС повышают токсичность лития потому, что:",
        "options": [
            "Снижают почечный клиренс лития через ингибирование простагландинов",
            "Ингибируют CYP3A4",
            "Конкурируют с литием за связывание с белками плазмы",
            "Повышают всасывание лития в кишечнике",
        ],
        "correct": 0,
        "explanation": "Простагландины регулируют почечный кровоток и канальцевую реабсорбцию. НПВС, ингибируя ЦОГ, снижают простагландины → уменьшается почечный клиренс лития → накопление → токсичность.",
        "category": "Взаимодействия",
        "difficulty": "hard",
    },
    {
        "question": "Вальпроат повышает уровень ламотриджина примерно в 2 раза, потому что:",
        "options": [
            "Ингибирует UGT (уридин-5'-дифосфатглюкуронозилтрансфераза) — основной путь метаболизма ламотриджина",
            "Ингибирует CYP3A4",
            "Снижает почечный клиренс ламотриджина",
            "Нарушает всасывание ламотриджина",
        ],
        "correct": 0,
        "explanation": "Ламотриджин метаболизируется глюкуронидированием (UGT1A4). Вальпроат ингибирует этот фермент. При их совместном применении дозу ламотриджина необходимо вдвое уменьшить.",
        "category": "Взаимодействия",
        "difficulty": "hard",
    },
    {
        "question": "Пароксетин снижает эффективность тамоксифена при раке молочной железы потому, что:",
        "options": [
            "Ингибирует CYP2D6, снижая конверсию тамоксифена в активный метаболит эндоксифен",
            "Вытесняет тамоксифен из связи с белками плазмы",
            "Ускоряет метаболизм тамоксифена через индукцию CYP3A4",
            "Блокирует эстрогеновые рецепторы",
        ],
        "correct": 0,
        "explanation": "Тамоксифен — пролекарство, активируется CYP2D6 до эндоксифена. Пароксетин — мощный ингибитор CYP2D6. При их совместном применении уровень эндоксифена снижается на 65–75%.",
        "category": "Взаимодействия",
        "difficulty": "hard",
    },
    {
        "question": "Комбинация клозапина с бензодиазепинами в/м опасна из-за риска:",
        "options": [
            "Тяжёлой гипотензии и остановки дыхания",
            "Серотонинового синдрома",
            "Гипертонического криза",
            "Агранулоцитоза",
        ],
        "correct": 0,
        "explanation": "Несколько случаев смерти от сердечно-лёгочной остановки при в/м введении бензодиазепина пациентам, получающим клозапин. Если необходимо, лучше разделить приём на несколько часов.",
        "category": "Взаимодействия",
        "difficulty": "hard",
    },
    # Pharmacokinetics
    {
        "question": "Флуоксетин имеет уникальный фармакокинетический профиль среди SSRI потому что:",
        "options": [
            "Длинный T½ и активный метаболит норфлуоксетин (T½ 7–15 дней)",
            "Не метаболизируется в печени",
            "Полностью выводится почками в неизменённом виде",
            "Самый короткий T½ среди SSRI",
        ],
        "correct": 0,
        "explanation": "Из-за длительного T½ флуоксетин фактически самоотменяется плавно, что минимизирует синдром отмены. Но зато после отмены нужно дольше ждать перед переходом на MAOI (5 недель!).",
        "category": "Фармакокинетика",
        "difficulty": "medium",
    },
    {
        "question": "Лоразепам предпочтительнее диазепама при тяжёлой печёночной недостаточности, потому что:",
        "options": [
            "Конъюгируется с глюкуроновой кислотой (не требует окисления CYP450)",
            "Полностью выводится почками",
            "Не образует активных метаболитов и имеет более короткий T½",
            "Оба верны: конъюгация + нет активных метаболитов",
        ],
        "correct": 3,
        "explanation": "Лоразепам (как и оксазепам, темазепам — 'LOT') метаболизируется только через глюкуронидирование, которое при циррозе нарушается меньше, чем CYP-зависимое окисление. Плюс — нет активных метаболитов.",
        "category": "Фармакокинетика",
        "difficulty": "hard",
    },
    {
        "question": "Арипипразол имеет один из самых длинных T½ среди антипсихотиков (~75 ч). Что это означает клинически?",
        "options": [
            "Равновесная концентрация достигается за ~2 недели, резкая отмена менее опасна",
            "Нужно принимать несколько раз в день",
            "Быстрое наступление эффекта",
            "Высокий риск накопления при почечной недостаточности",
        ],
        "correct": 0,
        "explanation": "Длинный T½ = медленная элиминация = постепенное снижение уровня при пропуске дозы. Прием 1 раз в сутки, иногда через день. Существует и ежемесячная депо-форма.",
        "category": "Фармакокинетика",
        "difficulty": "medium",
    },
    {
        "question": "Курение снижает уровень клозапина и оланзапина в крови из-за:",
        "options": [
            "Индукции CYP1A2 полициклическими ароматическими углеводородами табачного дыма",
            "Ингибирования CYP3A4 никотином",
            "Ускорения почечного клиренса",
            "Снижения абсорбции в ЖКТ",
        ],
        "correct": 0,
        "explanation": "Не никотин, а продукты горения индуцируют CYP1A2 — главный фермент метаболизма клозапина и оланзапина. При отказе от курения уровень этих препаратов может значительно вырасти.",
        "category": "Фармакокинетика",
        "difficulty": "hard",
    },
]


def get_questions_by_category(category: str) -> list:
    return [q for q in QUESTIONS if q["category"] == category]


def get_questions_by_difficulty(difficulty: str) -> list:
    return [q for q in QUESTIONS if q["difficulty"] == difficulty]


def get_filtered_questions(category: str = None, difficulty: str = None) -> list:
    """Получить отфильтрованные вопросы викторины."""
    from exceptions import QuizQuestionError
    result = QUESTIONS
    if category and category not in CATEGORIES:
        raise QuizQuestionError(f"Категория '{category}' не существует")
    if category:
        result = [q for q in result if q["category"] == category]
    if difficulty:
        valid_difficulties = ["easy", "medium", "hard"]
        if difficulty not in valid_difficulties:
            raise QuizQuestionError(f"Уровень сложности '{difficulty}' не существует. Доступные: {valid_difficulties}")
        result = [q for q in result if q["difficulty"] == difficulty]
    return result
